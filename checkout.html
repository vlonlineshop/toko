<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .checkout-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        h2, h3 {
            color: #333;
            margin-top: 20px;
            font-size: 1.5rem;
        }

        label {
            font-weight: bold;
            color: #333;
            display: block;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .address, .cart-items, .payment-methods, .voucher-section {
            margin-top: 20px;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .cart-items div {
            padding: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .cart-items div p {
            margin: 5px 0;
            font-size: 1rem;
            color: #555;
        }

        .cart-items button, .voucher-button, .payment-methods input {
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
        }

        .cart-items button {
            background-color: #e74c3c;
            color: white;
            margin-right: 10px;
        }

        .cart-items button:hover {
            background-color: #c0392b;
        }

        .voucher-button {
            background-color: #f39c12;
            color: white;
            margin-top: 10px;
        }

        .voucher-button:hover {
            background-color: #e67e22;
        }

        .payment-methods input {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        #total-cost {
            margin-top: 20px;
            font-size: 1.2em;
        }

        #final-total {
            color: #27ae60;
            font-weight: bold;
        }

        .voucher-message {
            margin-top: 10px;
            color: green;
            font-size: 1rem;
        }

        .voucher-error {
            margin-top: 10px;
            color: red;
            font-size: 1rem;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-top: 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background-color: #2980b9;
        }

    </style>
</head>
<body>
    <div class="checkout-container">
        <h1>Halaman Checkout</h1>

        <!-- Alamat Pengiriman -->
        <div class="address">
            <label for="address">Alamat Pengiriman:</label>
            <textarea id="address" placeholder="Masukkan alamat pengiriman..." required></textarea>
            <button id="save-address">Simpan Alamat</button>
        </div>

        <!-- Keranjang Belanja -->
        <h2>Rincian Pesanan</h2>
        <div id="cart-items"></div>

        <!-- Penghitungan Ongkir -->
        <div class="shipping">
            <label for="shipping">Ongkos Kirim: </label>
            <span id="shipping-cost">Rp 0</span>
        </div>

        <!-- Opsi Pembayaran -->
        <h3>Metode Pembayaran</h3>
        <div class="payment-methods">
            <input type="radio" id="bca" name="payment" value="BCA">
            <label for="bca">Transfer Bank BCA (Admin: Rp 2,500)</label><br>

            <input type="radio" id="qris" name="payment" value="QRIS">
            <label for="qris">QRIS (Admin: 1%)</label><br>

            <input type="radio" id="ewallet" name="payment" value="E-Wallet">
            <label for="ewallet">Transfer E-Wallet (Admin: Rp 1,500)</label><br>

            <input type="radio" id="cod" name="payment" value="COD">
            <label for="cod">Cash On Delivery (COD) (Admin: 2%)</label><br>
        </div>

        <!-- Fitur Voucher -->
        <div class="voucher-section">
            <label for="voucher-code">Kode Voucher (jika ada):</label>
            <input type="text" id="voucher-code" class="voucher-input" placeholder="Masukkan kode voucher">
            <button class="voucher-button" id="apply-voucher">Gunakan Voucher</button>
            <p id="voucher-message" class="voucher-message"></p>
            <p id="voucher-error" class="voucher-error"></p>
        </div>

        <!-- Total Pembayaran -->
        <h3>Total Pembayaran</h3>
        <div id="total-cost">
            <p>Harga Total: <span id="total-price">Rp 0</span></p>
            <p>Ongkos Kirim: <span id="final-shipping-cost">Rp 0</span></p>
            <p><strong>Total: <span id="final-total">Rp 0</span></strong></p>
        </div>

        <!-- Tombol Kirim Pesanan -->
        <button id="place-order">Kirim Pesanan</button>
    </div>

    <script>
        // Voucher diskon yang tersedia
        const vouchers = {
            'DISKON10': 0.1,  // Diskon 10%
            'HAPPY20': 0.2   // Diskon 20%
        };

        // Mengambil data dari localStorage
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const address = localStorage.getItem('address') || '';

        // Menampilkan alamat pengiriman yang disimpan
        document.getElementById('address').value = address;

        // Fungsi untuk menampilkan item keranjang
        function displayCartItems() {
            const cartContainer = document.getElementById('cart-items');
            cartContainer.innerHTML = '';
            let totalPrice = 0;
            
            cart.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.innerHTML = `
                    <p><strong>Nama Produk:</strong> ${item.name}</p>
                    <p><strong>Color/Garansi:</strong> ${item.color || 'N/A'} / ${item.warranty || 'N/A'}</p>
                    <p><strong>Variant:</strong> ${item.variant}</p>
                    <p><strong>Harga:</strong> Rp ${item.price.toLocaleString()}</p>
                    <button onclick="removeFromCart('${item.name}')">Hapus</button>
                    <button onclick="updateQuantity('${item.name}', 'increase')">Tambah</button>
                    <button onclick="updateQuantity('${item.name}', 'decrease')">Kurangi</button>
                `;
                cartContainer.appendChild(itemDiv);
                totalPrice += item.price;
            });

            document.getElementById('total-price').innerText = `Rp ${totalPrice.toLocaleString()}`;
            return totalPrice;
        }

        // Fungsi untuk menambahkan atau mengurangi kuantitas
        function updateQuantity(productName, action) {
            const product = cart.find(item => item.name === productName);
            if (product) {
                if (action === 'increase') {
                    product.quantity += 1;
                } else if (action === 'decrease' && product.quantity > 1) {
                    product.quantity -= 1;
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCartItems();
            }
        }

        // Fungsi untuk menghapus item dari keranjang
        function removeFromCart(productName) {
            const updatedCart = cart.filter(item => item.name !== productName);
            localStorage.setItem('cart', JSON.stringify(updatedCart));
            displayCartItems();
        }

        // Fungsi untuk mengatur ongkir secara acak
        function calculateShipping() {
            const randomShippingCost = Math.floor(Math.random() * 6) * 2000 + 5000;
            localStorage.setItem('shipping-cost', randomShippingCost);
            document.getElementById('shipping-cost').innerText = `Rp ${randomShippingCost.toLocaleString()}`;
            return randomShippingCost;
        }

        // Menghitung total harga termasuk ongkir dan admin
        function calculateTotal() {
            const cartTotal = displayCartItems();
            const shippingCost = calculateShipping();
            const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value || 'BCA';

            let adminFee = 0;
            if (paymentMethod === 'BCA') adminFee = 2500;
            if (paymentMethod === 'QRIS') adminFee = cartTotal * 0.01;
            if (paymentMethod === 'E-Wallet') adminFee = 1500;
            if (paymentMethod === 'COD') adminFee = cartTotal * 0.02;

            let finalTotal = cartTotal + shippingCost + adminFee;

            // Mengaplikasikan diskon voucher
            const voucherDiscount = parseFloat(localStorage.getItem('voucher-discount')) || 0;
            finalTotal = finalTotal * (1 - voucherDiscount);

            document.getElementById('final-shipping-cost').innerText = `Rp ${shippingCost.toLocaleString()}`;
            document.getElementById('final-total').innerText = `Rp ${finalTotal.toLocaleString()}`;
            return finalTotal;
        }

        // Menyimpan alamat ke localStorage
        document.getElementById('save-address').addEventListener('click', function() {
            const address = document.getElementById('address').value;
            localStorage.setItem('address', address);
            alert('Alamat berhasil disimpan!');
        });

        // Menerapkan voucher
        document.getElementById('apply-voucher').addEventListener('click', function() {
            const voucherCode = document.getElementById('voucher-code').value.toUpperCase();
            const voucherMessage = document.getElementById('voucher-message');
            const voucherError = document.getElementById('voucher-error');

            if (vouchers[voucherCode]) {
                localStorage.setItem('voucher-discount', vouchers[voucherCode]);
                voucherMessage.innerText = `Voucher diterapkan! Diskon: ${vouchers[voucherCode] * 100}%`;
                voucherError.innerText = '';
                calculateTotal();
            } else {
                voucherMessage.innerText = '';
                voucherError.innerText = 'Kode voucher tidak valid.';
            }
        });

        // Menyimpan rincian pesanan ke WhatsApp
        document.getElementById('place-order').addEventListener('click', function() {
            const finalTotal = calculateTotal();
            const shippingCost = document.getElementById('final-shipping-cost').innerText;
            const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value || 'BCA';
            
            const orderDetails = {
                cart: cart.map(item => `${item.name} - ${item.variant} - Rp ${item.price.toLocaleString()}`).join('\n'),
                shipping: shippingCost,
                total: finalTotal,
                paymentMethod: paymentMethod,
                address: localStorage.getItem('address')
            };
            
            const whatsappMessage = `Pesanan Baru:\n${orderDetails.cart}\nOngkir: ${orderDetails.shipping}\nTotal: Rp ${orderDetails.total.toLocaleString()}\nMetode Pembayaran: ${orderDetails.paymentMethod}\nAlamat: ${orderDetails.address}`;
            window.open(`https://wa.me/085709458101?text=${encodeURIComponent(whatsappMessage)}`);
        });

        // Mulai proses
        displayCartItems();
    </script>
</body>
</html>
