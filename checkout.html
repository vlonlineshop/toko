<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .checkout-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }

        h2, h3 {
            margin-top: 20px;
            font-size: 1.5rem;
            color: #333;
        }

        label {
            font-weight: bold;
            color: #333;
            font-size: 1rem;
            margin-bottom: 8px;
            display: block;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        /* Styles for the Address Section */
        .address {
            margin-top: 20px;
        }

        .address-form {
            display: none;
            margin-top: 15px;
            animation: slideDown 0.5s ease-out;
        }

        .address-form.show {
            display: block;
        }

        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .address textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 15px;
        }

        /* Cart Item Styles */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .cart-item button {
            background-color: #e74c3c;
        }

        .cart-item button:hover {
            background-color: #c0392b;
        }

        .cart-item .controls button {
            margin: 0 5px;
        }

        /* Payment Section */
        .payment-methods {
            margin-top: 20px;
        }

        .payment-methods input {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .voucher-section {
            margin-top: 20px;
        }

        .voucher-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            width: 60%;
            margin-right: 10px;
        }

        .voucher-message {
            color: green;
            font-size: 1rem;
            margin-top: 10px;
        }

        .voucher-error {
            color: red;
            font-size: 1rem;
            margin-top: 10px;
        }

        .total-cost {
            margin-top: 20px;
            font-size: 1.2rem;
        }

        .final-total {
            font-weight: bold;
            color: #27ae60;
        }

        /* Shipping Section */
        .shipping {
            margin-top: 20px;
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .voucher-input {
                width: 100%;
            }

            .checkout-container {
                padding: 15px;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .cart-item .controls {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="checkout-container">
        <h1>Halaman Checkout</h1>

        <!-- Address Section -->
        <div class="address">
            <button id="add-address-btn">Tambah Alamat</button>
            <div id="address-form" class="address-form">
                <label for="address">Alamat Pengiriman:</label>
                <textarea id="address" placeholder="Masukkan alamat pengiriman..." required></textarea>
                <button id="save-address">Simpan Alamat</button>
            </div>
        </div>

        <!-- Cart Items -->
        <h2>Rincian Pesanan</h2>
        <div id="cart-items"></div>

        <!-- Shipping Cost -->
        <div class="shipping">
            <label for="shipping">Ongkos Kirim: </label>
            <span id="shipping-cost">Rp 0</span>
        </div>

        <!-- Payment Methods -->
        <h3>Metode Pembayaran</h3>
        <div class="payment-methods">
            <input type="radio" id="bca" name="payment" value="BCA">
            <label for="bca">Transfer Bank BCA (Admin: Rp 2,500)</label><br>

            <input type="radio" id="qris" name="payment" value="QRIS">
            <label for="qris">QRIS (Admin: 1%)</label><br>

            <input type="radio" id="ewallet" name="payment" value="E-Wallet">
            <label for="ewallet">Transfer E-Wallet (Admin: Rp 1,500)</label><br>

            <input type="radio" id="cod" name="payment" value="COD">
            <label for="cod">Cash On Delivery (COD) (Admin: 2%)</label><br>
        </div>

        <!-- Voucher Section -->
        <div class="voucher-section">
            <label for="voucher-code">Kode Voucher (jika ada):</label>
            <input type="text" id="voucher-code" class="voucher-input" placeholder="Masukkan kode voucher">
            <button class="voucher-button" id="apply-voucher">Gunakan Voucher</button>
            <p id="voucher-message" class="voucher-message"></p>
            <p id="voucher-error" class="voucher-error"></p>
        </div>

        <!-- Total Cost Section -->
        <div class="total-cost">
            <p>Harga Total: <span id="total-price">Rp 0</span></p>
            <p>Ongkos Kirim: <span id="final-shipping-cost">Rp 0</span></p>
            <p><strong>Total: <span id="final-total" class="final-total">Rp 0</span></strong></p>
        </div>

        <!-- Place Order Button -->
        <button id="place-order">Kirim Pesanan</button>
    </div>

    <script>
        // Script untuk menangani checkout

        // Mengambil data dari localStorage
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const address = localStorage.getItem('address') || '';

        // Menampilkan alamat yang sudah disimpan jika ada
        if (address) {
            document.getElementById('address').value = address;
        }

        // Menampilkan item keranjang
        function displayCartItems() {
            const cartContainer = document.getElementById('cart-items');
            cartContainer.innerHTML = '';
            let totalPrice = 0;

            cart.forEach((item, index) => {
                const itemRow = document.createElement('div');
                itemRow.classList.add('cart-item');
                itemRow.innerHTML = `
                    <div><strong>${item.name}</strong> - Rp ${item.price.toLocaleString()}</div>
                    <div class="controls">
                        <button class="decrease-btn" data-index="${index}">-</button>
                        <span>${item.quantity}</span>
                        <button class="increase-btn" data-index="${index}">+</button>
                        <button class="remove-btn" data-index="${index}">Hapus</button>
                    </div>
                `;
                cartContainer.appendChild(itemRow);
                totalPrice += item.price * item.quantity;
            });

            document.getElementById('total-price').innerText = `Rp ${totalPrice.toLocaleString()}`;
            return totalPrice;
        }

        // Fungsi untuk menghitung ongkir
        function calculateShipping() {
            const randomShippingCost = Math.floor(Math.random() * 6) * 2000 + 5000;
            localStorage.setItem('shipping-cost', randomShippingCost);
            document.getElementById('shipping-cost').innerText = `Rp ${randomShippingCost.toLocaleString()}`;
            return randomShippingCost;
        }

        // Menghitung total harga dengan ongkir dan admin
        function calculateTotal() {
            const cartTotal = displayCartItems();
            const shippingCost = calculateShipping();
            const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value || 'BCA';

            let adminFee = 0;
            if (paymentMethod === 'BCA') adminFee = 2500;
            if (paymentMethod === 'QRIS') adminFee = cartTotal * 0.01;
            if (paymentMethod === 'E-Wallet') adminFee = 1500;
            if (paymentMethod === 'COD') adminFee = cartTotal * 0.02;

            let finalTotal = cartTotal + shippingCost + adminFee;

            // Mengaplikasikan diskon voucher
            const voucherDiscount = parseFloat(localStorage.getItem('voucher-discount')) || 0;
            finalTotal = finalTotal * (1 - voucherDiscount);

            document.getElementById('final-shipping-cost').innerText = `Rp ${shippingCost.toLocaleString()}`;
            document.getElementById('final-total').innerText = `Rp ${finalTotal.toLocaleString()}`;
            return finalTotal;
        }

        // Menyimpan alamat ke localStorage
        document.getElementById('save-address').addEventListener('click', function() {
            const address = document.getElementById('address').value;
            localStorage.setItem('address', address);
            alert('Alamat berhasil disimpan!');
            document.getElementById('address-form').classList.remove('show');
        });

        // Menerapkan voucher
        document.getElementById('apply-voucher').addEventListener('click', function() {
            const voucherCode = document.getElementById('voucher-code').value.toUpperCase();
            const voucherMessage = document.getElementById('voucher-message');
            const voucherError = document.getElementById('voucher-error');

            if (vouchers[voucherCode]) {
                localStorage.setItem('voucher-discount', vouchers[voucherCode]);
                voucherMessage.innerText = `Voucher diterapkan! Diskon: ${vouchers[voucherCode] * 100}%`;
                voucherError.innerText = '';
                calculateTotal();
            } else {
                voucherMessage.innerText = '';
                voucherError.innerText = 'Kode voucher tidak valid.';
            }
        });

        // Menampilkan animasi slide down untuk form alamat
        document.getElementById('add-address-btn').addEventListener('click', function() {
            const addressForm = document.getElementById('address-form');
            if (addressForm.style.display === 'block') {
                addressForm.classList.remove('show');
            } else {
                addressForm.classList.add('show');
            }
        });

        // Menyimpan rincian pesanan ke WhatsApp
        document.getElementById('place-order').addEventListener('click', function() {
            const finalTotal = calculateTotal();
            const shippingCost = document.getElementById('final-shipping-cost').innerText;
            const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value || 'BCA';
            
            const orderDetails = {
                cart: cart.map(item => `${item.name} - ${item.variant} - Rp ${item.price.toLocaleString()}`).join('\n'),
                shipping: shippingCost,
                total: finalTotal,
                paymentMethod: paymentMethod,
                address: localStorage.getItem('address')
            };
            
            const whatsappMessage = `Pesanan Baru:\n${orderDetails.cart}\nOngkir: ${orderDetails.shipping}\nTotal: Rp ${orderDetails.total.toLocaleString()}\nMetode Pembayaran: ${orderDetails.paymentMethod}\nAlamat: ${orderDetails.address}`;
            window.open(`https://wa.me/085709458101?text=${encodeURIComponent(whatsappMessage)}`);
        });

        // Event listeners untuk tombol tambah, kurang, dan hapus produk
        document.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('increase-btn')) {
                const index = e.target.getAttribute('data-index');
                cart[index].quantity += 1;
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCartItems();
                calculateTotal();
            }

            if (e.target && e.target.classList.contains('decrease-btn')) {
                const index = e.target.getAttribute('data-index');
                if (cart[index].quantity > 1) {
                    cart[index].quantity -= 1;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    displayCartItems();
                    calculateTotal();
                }
            }

            if (e.target && e.target.classList.contains('remove-btn')) {
                const index = e.target.getAttribute('data-index');
                cart.splice(index, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCartItems();
                calculateTotal();
            }
        });

        // Mulai proses
        displayCartItems();
    </script>

</body>
</html>
